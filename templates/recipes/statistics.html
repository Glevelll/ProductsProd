{% extends 'base.html' %}

{% block title %}{{ title }} - {{ block.super }}{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; color: #2c3e50;">üìà {{ title }}</h1>

<div style="margin-bottom: 2rem;">
    <a href="{% url 'analytics_dashboard' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥ –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</a>
    <a href="{% url 'dbapi_stats' %}" class="btn btn-primary">dbAPI –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
</div>

{% if recipe_stats %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 5px;">
            <h4>–í—Å–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #3498db;">{{ recipe_stats.total_recipes }}</p>
        </div>
        {% if recipe_stats.statistics.cooking_time %}
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 5px;">
            <h4>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #27ae60;">{{ recipe_stats.statistics.cooking_time.mean }} –º–∏–Ω</p>
        </div>
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 5px;">
            <h4>–ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #e67e22;">{{ recipe_stats.statistics.cooking_time.median }} –º–∏–Ω</p>
        </div>
        {% endif %}
    </div>

    {% if recipe_stats.top_authors %}
    <h3 style="margin-top: 2rem;">–¢–æ–ø –∞–≤—Ç–æ—Ä–æ–≤</h3>
    <ul style="list-style: none; padding: 0;">
        {% for author, count in recipe_stats.top_authors.items %}
        <li style="padding: 0.5rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 5px;">
            <strong>{{ author }}</strong>: {{ count }} —Ä–µ—Ü–µ–ø—Ç–æ–≤
        </li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

{% if ingredient_analysis %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–ê–Ω–∞–ª–∏–∑ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</h2>
    <p>–í—Å–µ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤: <strong>{{ ingredient_analysis.total_ingredients }}</strong></p>
    <p>–°—Ä–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: <strong>{{ ingredient_analysis.avg_usage }}</strong></p>

    {% if ingredient_analysis.most_used %}
    <h3 style="margin-top: 1.5rem;">–°–∞–º—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ</h3>
    <ul style="list-style: none; padding: 0;">
        {% for ing in ingredient_analysis.most_used %}
        <li style="padding: 0.5rem; background: #d4edda; margin-bottom: 0.5rem; border-radius: 5px;">
            {{ ing.name }}: {{ ing.usage_count }} —Ä–∞–∑
        </li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

{% if correlation %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="border: 1px solid #ddd; padding: 8px;">–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                {% for key in correlation.keys %}
                <th style="border: 1px solid #ddd; padding: 8px;">{{ key }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for param, values in correlation.items %}
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">{{ param }}</td>
                {% for value in values.values %}
                <td style="border: 1px solid #ddd; padding: 8px;">{{ value|floatformat:2 }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if user_shopping_analysis.total_items %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–í–∞—à —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (–∞–Ω–∞–ª–∏–∑)</h2>
    <p>–†–µ—Ü–µ–ø—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ: <strong>{{ user_shopping_analysis.total_items }}</strong></p>
    <p>–û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: <strong>{{ user_shopping_analysis.total_cooking_time }} –º–∏–Ω—É—Ç</strong></p>
    <p>–í—Å–µ–≥–æ –ø–æ—Ä—Ü–∏–π: <strong>{{ user_shopping_analysis.total_servings }}</strong></p>
</div>
{% endif %}
{% endblock %}

