{% extends 'base.html' %}

{% block title %}{{ title }} - {{ block.super }}{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; color: #2c3e50;">üîß {{ title }}</h1>

<div style="background: #fff3cd; padding: 1rem; border-radius: 5px; margin-bottom: 2rem; border-left: 4px solid #ffc107;">
    <strong>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:</strong> –ü—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ psycopg2 (dbAPI)
</div>

<div style="margin-bottom: 2rem;">
    <a href="{% url 'analytics_dashboard' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥ –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</a>
    <a href="{% url 'statistics' %}" class="btn btn-primary">Pandas –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
</div>

{% if recipe_stats %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ (SQL)</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="padding: 1rem; background: #e3f2fd; border-radius: 5px;">
            <h4>–í—Å–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h4>
            <p style="font-size: 2rem; font-weight: bold;">{{ recipe_stats.total_recipes }}</p>
        </div>
        <div style="padding: 1rem; background: #e8f5e9; border-radius: 5px;">
            <h4>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</h4>
            <p style="font-size: 2rem; font-weight: bold;">{{ recipe_stats.avg_cooking_time|floatformat:1 }} –º–∏–Ω</p>
        </div>
        <div style="padding: 1rem; background: #fff3e0; border-radius: 5px;">
            <h4>–ú–∞–∫—Å. –≤—Ä–µ–º—è</h4>
            <p style="font-size: 2rem; font-weight: bold;">{{ recipe_stats.max_cooking_time }} –º–∏–Ω</p>
        </div>
        <div style="padding: 1rem; background: #fce4ec; border-radius: 5px;">
            <h4>–ú–∏–Ω. –≤—Ä–µ–º—è</h4>
            <p style="font-size: 2rem; font-weight: bold;">{{ recipe_stats.min_cooking_time }} –º–∏–Ω</p>
        </div>
        <div style="padding: 1rem; background: #f3e5f5; border-radius: 5px;">
            <h4>–°—Ä–µ–¥–Ω–∏–µ –ø–æ—Ä—Ü–∏–∏</h4>
            <p style="font-size: 2rem; font-weight: bold;">{{ recipe_stats.avg_servings|floatformat:1 }}</p>
        </div>
    </div>
</div>
{% endif %}

{% if top_ingredients %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–¢–æ–ø –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (SQL JOIN)</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">#</th>
                <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</th>
                <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">–ï–¥–∏–Ω–∏—Ü–∞</th>
                <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</th>
            </tr>
        </thead>
        <tbody>
            {% for ing in top_ingredients %}
            <tr>
                <td style="border: 1px solid #ddd; padding: 12px;">{{ forloop.counter }}</td>
                <td style="border: 1px solid #ddd; padding: 12px;"><strong>{{ ing.name }}</strong></td>
                <td style="border: 1px solid #ddd; padding: 12px;">{{ ing.unit }}</td>
                <td style="border: 1px solid #ddd; padding: 12px;">{{ ing.usage_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if user_stats %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <ul style="list-style: none; padding: 0;">
        <li style="padding: 0.75rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 5px;">
            –í–∞—à–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤: <strong>{{ user_stats.total_recipes }}</strong>
        </li>
        <li style="padding: 0.75rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 5px;">
            –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: <strong>{{ user_stats.avg_cooking_time|floatformat:1 }} –º–∏–Ω</strong>
        </li>
        <li style="padding: 0.75rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 5px;">
            –†–µ—Ü–µ–ø—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é: <strong>{{ user_stats.recent_recipes }}</strong>
        </li>
    </ul>
</div>
{% endif %}

{% if shopping_summary %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (SQL GROUP BY)</h2>
    <ul style="list-style: none; padding: 0;">
        {% for item in shopping_summary %}
        <li style="padding: 0.75rem; background: #d4edda; margin-bottom: 0.5rem; border-radius: 5px; display: flex; justify-content: space-between;">
            <span><strong>{{ item.name }}</strong></span>
            <span>{{ item.total_quantity }} {{ item.unit }}</span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endblock %}

