{% extends 'base.html' %}

{% block title %}{{ title }} - {{ block.super }}{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; color: #2c3e50;">ü§ñ {{ title }}</h1>

<div style="background: #d1ecf1; padding: 1rem; border-radius: 5px; margin-bottom: 2rem; border-left: 4px solid #0c5460;">
    <strong>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:</strong> scikit-learn (TF-IDF, –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ, K-Means –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
</div>

<div style="margin-bottom: 2rem;">
    <a href="{% url 'analytics_dashboard' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥ –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</a>
</div>

{% if current_recipe %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–¢–µ–∫—É—â–∏–π —Ä–µ—Ü–µ–ø—Ç</h2>
    <h3>{{ current_recipe.title }}</h3>
    <p>{{ current_recipe.description }}</p>
</div>

    {% if similar_recipes %}
    <div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
        <h2 style="color: #2c3e50;">–ü–æ—Ö–æ–∂–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã (ML)</h2>
        <p style="color: #666; margin-bottom: 1rem;">
            –ù–∞ –æ—Å–Ω–æ–≤–µ TF-IDF –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
        </p>
        <div style="display: grid; gap: 1rem;">
            {% for recipe in similar_recipes %}
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #3498db;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h4 style="margin: 0 0 0.5rem 0;">
                            <a href="{% url 'recipe_detail' recipe.id %}">{{ recipe.title }}</a>
                        </h4>
                        <p style="color: #666; font-size: 0.9rem; margin: 0;">
                            –í—Ä–µ–º—è: {{ recipe.cooking_time }} –º–∏–Ω | –ü–æ—Ä—Ü–∏–π: {{ recipe.servings }}
                        </p>
                    </div>
                    <div style="background: #3498db; color: white; padding: 0.5rem 1rem; border-radius: 5px;">
                        –°—Ö–æ–¥—Å—Ç–≤–æ: {{ recipe.similarity_score|floatformat:3 }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if difficulty_prediction %}
    <div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
        <h2 style="color: #2c3e50;">–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h2>
        <div style="padding: 1.5rem; background: 
            {% if difficulty_prediction.difficulty == '–õ–µ–≥–∫–∏–π' %}#d4edda{% elif difficulty_prediction.difficulty == '–°—Ä–µ–¥–Ω–∏–π' %}#fff3cd{% else %}#f8d7da{% endif %}; 
            border-radius: 5px;">
            <h3 style="margin: 0 0 1rem 0;">–°–ª–æ–∂–Ω–æ—Å—Ç—å: {{ difficulty_prediction.difficulty }}</h3>
            <p>–û—Ü–µ–Ω–∫–∞: {{ difficulty_prediction.difficulty_score }} / 6</p>
            <p style="font-size: 0.9rem; color: #666;">
                –í—Ä–µ–º—è: {{ difficulty_prediction.factors.cooking_time }} –º–∏–Ω | 
                –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤: {{ difficulty_prediction.factors.ingredients_count }}
            </p>
        </div>
    </div>
    {% endif %}
{% endif %}

{% if quick_recipes %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–ë—ã—Å—Ç—Ä—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã (–¥–æ 30 –º–∏–Ω)</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
        {% for recipe in quick_recipes %}
        <div style="padding: 1rem; background: #e8f5e9; border-radius: 5px;">
            <h4><a href="{% url 'recipe_detail' recipe.id %}">{{ recipe.title }}</a></h4>
            <p style="color: #666; font-size: 0.9rem;">
                ‚è±Ô∏è {{ recipe.cooking_time }} –º–∏–Ω | üë• {{ recipe.servings }} –ø–æ—Ä—Ü–∏–π
            </p>
            <a href="{% url 'ml_recommendations_recipe' recipe.id %}" class="btn btn-small btn-primary">
                –ü–æ—Ö–æ–∂–∏–µ
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if ingredient_importance %}
<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">–ê–Ω–∞–ª–∏–∑ –≤–∞–∂–Ω–æ—Å—Ç–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</h2>
    <p style="color: #666; margin-bottom: 1rem;">
        –ù–∞ –æ—Å–Ω–æ–≤–µ —á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
    </p>
    <div style="display: grid; gap: 0.5rem;">
        {% for ing in ingredient_importance %}
        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1;">
                <strong>{{ ing.name }}</strong>
                <div style="background: #ddd; height: 8px; border-radius: 4px; margin-top: 0.25rem; position: relative;">
                    <div style="background: #3498db; height: 100%; width: {{ ing.importance_score }}%; border-radius: 4px;"></div>
                </div>
            </div>
            <div style="margin-left: 1rem; color: #666;">
                {{ ing.usage_count }} —Ä–∞–∑ ({{ ing.importance_score|floatformat:0 }}%)
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">REST API –¥–ª—è ML</h2>
    <p>–î–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:</p>
    <ul>
        <li><code>GET /ml-api/similar/{recipe_id}/</code> - –ø–æ—Ö–æ–∂–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã</li>
        <li><code>POST /ml-api/by-ingredients/</code> - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º</li>
        <li><code>GET /ml-api/clusters/?n_clusters=5</code> - –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤</li>
        <li><code>GET /dbapi/search/?q=—Ç–µ—Ä–º–∏–Ω</code> - –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ SQL</li>
    </ul>
</div>
{% endblock %}

